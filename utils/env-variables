#!/bin/bash

THIS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

WORKDIR=${CUSTOM_WORKDIR}
if [ "${WORKDIR}" == "" ]; then
  # defaults to ./work inside this repository
  WORKDIR=$(realpath ${THIS_DIR}/../work)
fi

IMAGES='images'
CERTS_AND_CONFIGS='certs_and_configs'
TOOLS='tools'

IMAGES_DIR=${WORKDIR}/${IMAGES}
TEMPLATE_IP_FILE=${WORKDIR}/${IMAGES}/vm-template-ip.txt
TEMPLATE_XML=conf/vm-template.xml
VIRT_STORAGE_DIR=/var/lib/libvirt/images
VM_CONFIGS='vm_configs'
VM_CONFIGS_DIR=${WORKDIR}/${VM_CONFIGS}

CERTS_AND_CONFIGS_DIR=${WORKDIR}/${CERTS_AND_CONFIGS}

# key length
RSA_KEYLENGTH=${CUSTOM_RSA_KEYLENGTH}
if [ "${RSA_KEYLENGTH}" == "" ]; then RSA_KEYLENGTH=8192 ; fi

## default cert names
CA_CONFIG=${CERTS_AND_CONFIGS_DIR}/ca-config.json
CA_CSR=${CERTS_AND_CONFIGS_DIR}/ca-csr.json
CA_BARE=${CERTS_AND_CONFIGS_DIR}/ca
CA_PUB=${CERTS_AND_CONFIGS_DIR}/ca.pem
CA_KEY=${CERTS_AND_CONFIGS_DIR}/ca-key.pem

TOOLS_DIR=${WORKDIR}/${TOOLS}

## default TOOL versions and cmd paths
CFSSL_VERSION=${CUSTOM_CFSSL_VERSION}
if [ "${CFSSL_VERSION}" == "" ]; then CFSSL_VERSION='1.2' ; fi
CFSSL_CMD=${TOOLS_DIR}/cfssl-${CFSSL_VERSION}
CFSSLJSON_CMD=${TOOLS_DIR}/cfssljson-${CFSSL_VERSION}
CFSSLCERTINFO_CMD=${TOOLS_DIR}/cfssl-certinfo-${CFSSL_VERSION}

KUBERNETES_VERSION=${CUSTOM_KUBERNETES_VERSION}
if [ "${KUBERNETES_VERSION}" == "" ]; then KUBERNETES_VERSION='1.18.5' ; fi
KUBERNETES_ON_HYPERVISOR_DIR=${TOOLS_DIR}/kubernetes-${KUBERNETES_VERSION}
KUBECTL_CMD_ON_HYPERVISOR=${KUBERNETES_ON_HYPERVISOR_DIR}/kubernetes/client/bin/kubectl
